学习来源：
https://github.com/rlabbe/Kalman-and-Bayesian-Filters-in-Python
作者：
Roger Labbe（github）


# 第六章： 多维卡尔曼滤波

小知识点：

1：白噪声意味着噪声的均值为0

2：𝐏=(𝐈−𝐊𝐇)𝐏-，因存在矩阵减法，会导致P不稳定，所以一般程序中不使用该公式计算

3：RTS平滑算法：通过未来的测量决定是否融合当前测量(平滑器允许人们根据后来的观察来改进先前状态的估计,和卡尔曼滤波器相反)

4:客观性：是否可以通过观察系统的输出确定系统状态

### 多维卡尔曼滤波器通用公式：

![IMAGE ALT TEXT HERE](https://github.com/xdwgood/Navigation-and-control/blob/xdwgood-patch-1/9.png)
其中估计状态（x-，p-），过程（F，Q），测量（z，R）

### 设计状态变量（x-）

已对一个狗的位置进行跟踪为例子：**位置**信息为一个状态变量，**速度**为隐藏的状态变量

一点思考： 为什么我们不添加加速度为另一个隐藏变量？

答案：这是根据我们对系统的认知决定的，eg：我们认为狗不会不停的加速减速

### 设计状态协方差矩阵（P）

如果经过预测后我们对狗的俩个状态信念分别为，当前位置： 𝜎2𝚙𝚘𝚜=500𝑚2，当前速度：𝜎2𝚟𝚎𝚕=72=49，则设计的P如下图

![IMAGE ALT TEXT HERE](https://github.com/xdwgood/Navigation-and-control/blob/xdwgood-patch-1/5.png)

### 设计过程模型（F）

假设我们认为狗的速度不变，位置的变化使用牛顿运动方程描述（x = x + v × t），则设计如下图：

![IMAGE ALT TEXT HERE](https://github.com/xdwgood/Navigation-and-control/blob/xdwgood-patch-1/6.png)

如果我们设置过程噪声（Q）为0,连续进行五次预测环节（不引入测量），则P变化如下图：

**注意**:新的P矩阵中产生了协方差变化，位置协方差变大，速度协方差不变
![IMAGE ALT TEXT HERE](https://github.com/xdwgood/Navigation-and-control/blob/xdwgood-patch-1/7.png)

### 设计过程噪声（Q）

𝐐选取一般性原则：将其设置在1/2Δ𝑎---Δ𝑎，其中Δ𝑎是状态量在采样周期之间变化的最大量。下一章中会在进行设计具体描述。

**以上设计和预测环节相关**

### 设计测量函数（H、R）

H的作用是把当前系统状态转换为测量状态（空间），eg：如果我们想估计房间温度，而测量得到的是电压，则需把预测的温度先转化为电压值，在进行更新

R就是传感器精度/可靠性

为什么要在**测量空间**内操作？

如果跟踪问题的状态（位置）包含隐藏变量（eg：速度）则无法将位置的测量值转换为包含速度的状态。但我们可以根据过程模型把隐藏变量轻松转化为测量值。

一点思考：

𝐏¯=𝐅𝐏𝐅𝖳+𝐐 中𝐅𝐏𝐅𝖳的含义，计算如下图：（其中F为上）

![IMAGE ALT TEXT HERE](https://github.com/xdwgood/Navigation-and-control/blob/xdwgood-patch-1/8.png)

我们可以看到：实现了自动计算状态变量间相关性通过过程传递矩阵（F） **！！！**。类似的还有（𝐒=𝐇𝐏¯𝐇𝖳+𝐑），转化到H空间

### 卡尔曼增益

𝐒=𝐇𝐏¯𝐇𝖳+𝐑：预测不确定度 + 测量不确定度

𝐊=𝐏¯𝐇𝖳𝐒−1 = 𝐏¯𝐇𝖳 / 𝐒 = 预测不确定度 / 预测不确定度 + 测量不确定度

### 协方差更新（P）

𝐏=(𝐈−𝐊𝐇)𝐏- = 新预测最优状态的可信度，**P-** 为先验中当前状态可信度。我们可以近似理解为：P（新/后验） = （1 - K×常数H） × P（先验/预测）

这表示了 测量 vs 预测  最后的结果，K越大，系统将越不信任预测
